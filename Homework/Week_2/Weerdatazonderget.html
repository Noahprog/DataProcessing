<!--
DataProcessing week 2
Noah van Grinsven
10501916

-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Average temperature weather data, De Bilt 2010-2011</title>
    </head>

    <!-- #date,maxtemp  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< !!!!!!!!-->
    <textarea id="rawdata">
    20100101,  -16
    20100102,  -11
    20100103,  -39
    20100104,  -29
    20100105,   -7
    20100106,  -30
    20100107,  -49
    20100108,  -50
    20100109,  -22
    20100110,   -5
    20100111,   -4
    20100112,  -17
    20100113,  -30
    20100114,    6
    20100115,   13
    20100116,   10
    20100117,   39
    20100118,   40
    20100119,   40
    20100120,   27
    20100121,   27
    20100122,   22
    20100123,   13
    20100124,   -2
    20100125,  -32
    20100126,  -75
    20100127,  -23
    20100128,   32
    20100129,   19
    20100130,    0
    20100131,   12
    20100201,    1
    20100202,   23
    20100203,   22
    20100204,   58
    20100205,   44
    20100206,   28
    20100207,   12
    20100208,  -32
    20100209,  -33
    20100210,  -31
    20100211,  -25
    20100212,  -28
    20100213,  -17
    20100214,  -23
    20100215,  -36
    20100216,   -9
    20100217,   -2
    20100218,   32
    20100219,   33
    20100220,   14
    20100221,    6
    20100222,   40
    20100223,   21
    20100224,   63
    20100225,   82
    20100226,   73
    20100227,   68
    20100228,   64
    20100301,   42
    20100302,   29
    20100303,   20
    20100304,   15
    20100305,   18
    20100306,    8
    20100307,  -10
    20100308,    1
    20100309,    5
    20100310,    7
    20100311,   26
    20100312,   46
    20100313,   52
    20100314,   62
    20100315,   63
    20100316,   63
    20100317,   84
    20100318,  108
    20100319,  125
    20100320,  136
    20100321,   86
    20100322,   78
    20100323,   98
    20100324,  124
    20100325,  146
    20100326,  106
    20100327,   98
    20100328,   91
    20100329,  101
    20100330,  102
    20100331,   65
    20100401,   52
    20100402,   78
    20100403,   73
    20100404,   71
    20100405,   78
    20100406,  110
    20100407,  136
    20100408,   92
    20100409,  104
    20100410,   78
    20100411,   63
    20100412,   93
    20100413,   90
    20100414,   96
    20100415,   92
    20100416,   77
    20100417,   80
    20100418,  102
    20100419,   88
    20100420,   86
    20100421,   67
    20100422,   70
    20100423,   80
    20100424,  117
    20100425,  143
    20100426,  126
    20100427,  124
    20100428,  157
    20100429,  177
    20100430,  117
    20100501,  100
    20100502,   75
    20100503,   66
    20100504,   77
    20100505,   79
    20100506,   92
    20100507,   77
    20100508,   90
    20100509,   93
    20100510,   72
    20100511,   68
    20100512,   65
    20100513,   72
    20100514,   76
    20100515,   91
    20100516,  119
    20100517,  116
    20100518,  101
    20100519,  118
    20100520,  138
    20100521,  145
    20100522,  142
    20100523,  169
    20100524,  169
    20100525,  132
    20100526,  102
    20100527,  110
    20100528,  108
    20100529,  141
    20100530,  121
    20100531,  129
    20100601,  126
    20100602,  155
    20100603,  160
    20100604,  169
    20100605,  191
    20100606,  185
    20100607,  152
    20100608,  163
    20100609,  176
    20100610,  186
    20100611,  162
    20100612,  138
    20100613,  133
    20100614,  159
    20100615,  132
    20100616,  154
    20100617,  166
    20100618,  132
    20100619,  118
    20100620,  118
    20100621,  134
    20100622,  141
    20100623,  181
    20100624,  196
    20100625,  189
    20100626,  192
    20100627,  213
    20100628,  215
    20100629,  194
    20100630,  202
    20100701,  224
    20100702,  271
    20100703,  215
    20100704,  201
    20100705,  188
    20100706,  162
    20100707,  187
    20100708,  220
    20100709,  248
    20100710,  248
    20100711,  229
    20100712,  208
    20100713,  207
    20100714,  214
    20100715,  188
    20100716,  191
    20100717,  171
    20100718,  176
    20100719,  207
    20100720,  232
    20100721,  221
    20100722,  184
    20100723,  174
    20100724,  166
    20100725,  168
    20100726,  168
    20100727,  177
    20100728,  187
    20100729,  167
    20100730,  177
    20100731,  185
    20100801,  182
    20100802,  161
    20100803,  172
    20100804,  165
    20100805,  153
    20100806,  164
    20100807,  175
    20100808,  171
    20100809,  179
    20100810,  175
    20100811,  169
    20100812,  141
    20100813,  156
    20100814,  182
    20100815,  175
    20100816,  192
    20100817,  164
    20100818,  169
    20100819,  168
    20100820,  207
    20100821,  214
    20100822,  198
    20100823,  193
    20100824,  168
    20100825,  165
    20100826,  168
    20100827,  148
    20100828,  135
    20100829,  126
    20100830,  141
    20100831,  128
    20100901,  123
    20100902,  129
    20100903,  140
    20100904,  138
    20100905,  135
    20100906,  151
    20100907,  125
    20100908,  155
    20100909,  162
    20100910,  158
    20100911,  184
    20100912,  153
    20100913,  149
    20100914,  156
    20100915,  139
    20100916,  125
    20100917,  114
    20100918,  117
    20100919,  133
    20100920,  153
    20100921,  144
    20100922,  151
    20100923,  160
    20100924,  149
    20100925,  113
    20100926,   86
    20100927,  100
    20100928,  127
    20100929,   97
    20100930,  100
    20101001,  120
    20101002,  153
    20101003,  182
    20101004,  172
    20101005,  167
    20101006,  160
    20101007,  140
    20101008,  142
    20101009,  136
    20101010,  113
    20101011,   96
    20101012,   85
    20101013,   83
    20101014,   94
    20101015,  103
    20101016,   74
    20101017,   47
    20101018,   68
    20101019,   90
    20101020,   62
    20101021,   78
    20101022,   90
    20101023,   72
    20101024,   75
    20101025,   53
    20101026,   64
    20101027,   89
    20101028,  113
    20101029,  100
    20101030,  112
    20101031,   92
    20101101,   82
    20101102,  110
    20101103,  128
    20101104,  152
    20101105,  137
    20101106,   93
    20101107,   55
    20101108,   49
    20101109,   46
    20101110,   54
    20101111,   68
    20101112,  113
    20101113,  104
    20101114,  112
    20101115,   58
    20101116,   20
    20101117,   39
    20101118,   53
    20101119,   71
    20101120,   70
    20101121,   52
    20101122,   45
    20101123,   46
    20101124,   35
    20101125,   24
    20101126,   -1
    20101127,   -5
    20101128,  -30
    20101129,  -22
    20101130,  -16
    20101201,  -62
    20101202,  -69
    20101203,  -54
    20101204,  -21
    20101205,   23
    20101206,   -4
    20101207,  -23
    20101208,  -21
    20101209,   27
    20101210,   38
    20101211,   71
    20101212,   31
    20101213,  -17
    20101214,  -25
    20101215,    4
    20101216,   15
    20101217,  -22
    20101218,  -41
    20101219,  -49
    20101220,  -77
    20101221,  -39
    20101222,  -21
    20101223,   -7
    20101224,  -12
    20101225,  -16
    20101226,    5
    20101227,   -6
    20101228,    4
    20101229,    4
    20101230,  -16
    20101231,   25 </textarea>

    <h1>
        Noah van Grinsven (10501916) - DataProcessing
    </h1>
    <h3>
        Linegraph average Temperature
    </h3>

    <canvas id="myCanvas" height="500" width="900" solid #d3d3d3;"></canvas>
    <body>
        <script>
            var dataPerLine = document.getElementById("rawdata").value.split("\n");

            // store datapoints
            var dateData = [];
            var tempData = [];
            var startingp = 0;
            var secondp;
            var timeUnit = 1;
            var timePoint;
            for (i = 0; i < dataPerLine.length; i++) {
                var splitLine = dataPerLine[i].split(",");
                // store temperatures
                tempData.push(parseFloat(splitLine[1].trim()));

                // manipulate date data for storage
                var dateString = splitLine[0].trim();
                date = new Date(dateString.substring(0, 4), dateString.substring(4, 6) - 1, dateString.substring(6, 8));

                // create appropriate time-unit (not corrected for summer/winter time)
                if (dateData.length < 1) {
                    startingp = date.getTime()
                } else if (dateData.length === 1) {
                    secondp = date.getTime();
                    timeUnit = secondp - startingp;
                }

                // store datapoint per time-unit
                timePoint = (date.getTime() - startingp) / timeUnit + 1;
                dateData.push(timePoint);
            }

            // initiate canvas
            var canvas = document.getElementById('myCanvas');
            var ctx = canvas.getContext('2d');
            // ctx.fillStyle="#2c354b";
            // ctx.fillRect(0,0,canvas.width,canvas.height);

            // useful data for graph
            var xAxisOffset = 25;
            var yAxisOffset = 25;
            var margin = 50;
            var graphRange = [0, canvas.height - xAxisOffset - 2 * margin];
            var graphDomain = [0, canvas.width - yAxisOffset - 2 * margin];

            // round lowest point down and highest point up to nearest 5 degree Celsius
            var tempLow = Math.floor(Math.min.apply(Math, tempData)/50)*50;
            var tempHigh = Math.ceil(Math.max.apply(Math, tempData)/50)*50;
            var tempRange = [tempLow, tempHigh];
            var dateRange = [dateData[0], dateData[dateData.length - 1]];

            // useful data for axis and gridlines
            var nrMonths = 12;
            var verGridSize = graphDomain[1]/nrMonths;
            var nrHorGridlines = (tempHigh - tempLow)/50;
            var horGridSize = (graphRange[1] - graphRange[0])/nrHorGridlines;

            // Draw horizontal grid lines
            for(var i = 0; i <= nrHorGridlines; i++) {
                ctx.beginPath();
                ctx.lineWidth = 1;

                // represents X-axis draw in different color
                if(i === 0)
                    ctx.strokeStyle = "#000000";
                else
                    ctx.strokeStyle = "#e9e9e9";

                ctx.moveTo(yAxisOffset + margin, graphRange[1] + margin - horGridSize * i);
                ctx.lineTo(graphDomain[1] + yAxisOffset + margin, graphRange[1] + margin - horGridSize * i);
                ctx.stroke();
            }

            // Draw vertical grid lines
            for(i = 0; i <= nrMonths; i++) {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "#e9e9e9";

                // represents Y-axis draw in different color
                if(i === 0)
                    ctx.strokeStyle = "#000000";

                ctx.moveTo(verGridSize * i + yAxisOffset + margin, margin);
                ctx.lineTo(verGridSize * i + yAxisOffset + margin, graphRange[1] + margin);
                ctx.stroke();
            }

            var months = [" ", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dec"]

            // Ticks marks on the X-axis
            for(i = 0; i <= nrMonths; i++) {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "#000000";

                // Draw a tick mark 6px long (-3 to 3)
                ctx.moveTo(verGridSize * i + yAxisOffset + margin, graphRange[1]+ margin - 3);
                ctx.lineTo(verGridSize * i + yAxisOffset + margin, graphRange[1] + margin + 3);
                ctx.stroke();

                // Text value at that point
                ctx.font = '13px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(months[i], verGridSize * (i - 0.5) + yAxisOffset + margin, canvas.height - margin);
            }

            // Ticks marks on the Y-axis
            for(i=0; i <= (nrHorGridlines); i++) {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "#000000";

                // Draw a tick mark 6px long (-3 to 3)
                ctx.moveTo(yAxisOffset + margin - 3, graphRange[1] + margin - horGridSize * i);
                ctx.lineTo(yAxisOffset + margin + 3, graphRange[1] + margin - horGridSize * i);
                ctx.stroke();

                // Text value at that point
                ctx.font = '13px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(tempLow + i * 50, margin, graphRange[1] + margin - horGridSize * i + 4);
            }

            // get scalar
            var yscalar = createTransform(tempRange, graphRange);
            var xscalar = createTransform(dateRange, graphDomain);

            // draw graph
            ctx. strokeStyle = "#862627";
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(xscalar(dateData[0]) + yAxisOffset + margin, graphRange[1] + margin - yscalar(tempData[0]));
            for (i = 1; i < dateData.length; i++){
                ctx.lineTo(xscalar(dateData[i]) + yAxisOffset + margin , graphRange[1] + margin - yscalar(tempData[i]));
            }
            ctx.stroke();

            // put title and axis names in graph
            ctx. restore();
            ctx.font = "15px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Average Temperature De Bilt (2010)", 0.5*canvas.width, 0.5 * margin);
            ctx.font = "15px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Month of the year", 0.5*canvas.width, canvas.height - 0.5 * margin)
            ctx.textAlign = "center";
            ctx.rotate(-Math.PI/2);
            ctx.fillText("Temperature in 1/10°C", -0.5*canvas.height, 0.5*margin);

            function createTransform(domain, range){
                // domain is a two-element array of the data bounds [domain_min, domain_max]
                // range is a two-element array of the screen bounds [range_min, range_max]
                // this gives you two equations to solve:
                // range_min = alpha * domain_min + beta
                // range_max = alpha * domain_max + beta
                // a solution would be:

                var domain_min = domain[0];
                var domain_max = domain[1];
                var range_min = range[0];
                var range_max = range[1];

                // formulas to calculate the alpha and the beta
                var alpha = (range_max - range_min) / (domain_max - domain_min);
                var beta = range_max - alpha * domain_max;

                // returns the function for the linear transformation (y= a * x + b)
                return function(x){
                    return alpha * x + beta;
                }
            }

        </script>
    </body>
</html>